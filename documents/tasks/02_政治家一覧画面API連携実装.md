# 政治家一覧画面API連携実装

## 1. タスクの詳細

### タスク名
政治家一覧画面のAPI連携実装

### 目的
現在静的データで表示されている政治家一覧画面をバックエンドAPIと連携させ、実際のデータを表示できるようにする。

### 関連ドキュメント
- 01_frontend/documents/01_API連携/README.md
- 01_frontend/documents/01_API連携/api_hooks.md
- documents/画面設計書/POL-LIST-001_政治家一覧画面.md

### 優先度
高

### 対応日
2025/3/24

## 2. 対応内容

以下の作業を実施しました：

1. **静的データの置き換え**
   - `src/app/politicians/page.tsx`内のモックデータをAPIからの取得に置き換え
   - `usePoliticians` hookを使用して政治家データを取得
   - ローディング状態とエラー状態の処理を実装

2. **検索・フィルター機能の実装**
   - 検索ボックス入力時にAPIパラメータを更新
   - フィルター条件に応じたデータ取得を実装
   - 政党フィルターの実装

3. **ページネーションの実装**
   - APIのページネーションパラメータを使用して実装
   - 「前へ」「次へ」ボタンの機能を実装

4. **パフォーマンス最適化**
   - 不要な再レンダリングを防止
   - APIリクエストの重複を排除
   - 画面のちらつき問題を解消

## 3. 完了条件
- 政治家一覧画面がAPIから取得した実際の政治家データを表示できること
- 検索・フィルター機能が正常に動作し、条件に応じたデータが表示されること
- ページネーションが正常に動作し、ページ切り替えができること

## 4. 実装状況と課題

### 実装状況
1. **静的データの置き換え**
   - ✅ モックデータをAPIからの取得に置き換え
   - ✅ `usePoliticians` hookを使用して政治家データを取得
   - ✅ ローディング状態とエラー状態の処理を実装

2. **検索・フィルター機能の実装**
   - ✅ 検索ボックス入力時にAPIパラメータを更新
   - ✅ フィルター条件に応じたデータ取得を実装
   - ✅ 政党フィルターの実装
   - ✅ ソート機能の実装

3. **ページネーションの実装**
   - ✅ APIのページネーションパラメータを使用して実装
   - ✅ 「前へ」「次へ」ボタンの機能を実装
   - ✅ ページ番号の表示と選択機能を実装

### 課題と解決策
1. **認証エラー**
   - APIリクエストが401 Unauthorizedエラーで失敗
   - Swaggerドキュメントを確認すると、`/api/v1/politicians/`エンドポイントには認証が必要
   - 解決策：
     - バックエンドの`deps.py`ファイルを修正し、認証関連のコードを整理
     - 不適切なコメントアウト方法（三重引用符）を修正し、正しい方法（#記号）に変更
     - `politicians.py`の重複したコードを削除

2. **APIレスポンス形式の不一致**
   - `usePoliticians` hookの戻り値の型と実際のAPIレスポンス形式が一致していない
   - 解決策：
     - `usePoliticians.ts`を修正し、バックエンドのレスポンス形式（配列）をフロントエンドの期待する形式（items, totalを持つオブジェクト）に変換するロジックを実装
     - `PoliticiansResponse`インターフェースにコメントを追加して、変換処理の目的を明確化

3. **画面のちらつき問題**
   - 政治家一覧画面を開くと何度もAPIリクエストが発生し、画面がちらつく
   - 解決策：
     - 不要な再レンダリングを防ぐために`useEffect`の依存配列を最適化
     - `fetchPoliticians`関数を削除し、代わりに`useEffect`内で直接データを取得するように変更
     - `useEffect`の依存配列から`isLoading`と`politicians`を削除
     - 重複していた`handlePageChange`関数を削除

## 5. 次のステップ
1. 認証機能の実装（別タスクとして対応中）
2. 他の画面でも同様のパフォーマンス最適化を実施
3. ユーザーテストによる動作確認とUIの調整